<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml" xmlns:v-bind="http://www.w3.org/1999/xhtml"
      xmlns:cellspacing="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>bootsrap</title>
    <link rel="stylesheet"  href="../../css/style.css" >
    <!--<link rel="stylesheet" href="../../plugs/bootstrap/css/bootstrap.min.css">-->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" >

    <style type="text/css">
        .u-pages li{float: left;padding: 10px}
    </style>


</head>
<body style="background:#edf6fa;">

<div class="place">
    <span>位置：</span>
    <ul class="placeul">
        <li><a href="#">首页</a></li>
        <li><a href="../../page/followManage/personOutManage.html">患者出院信息管理</a></li>
    </ul>
</div>


<div id="exam" >
    <!--按钮模块-->
    <div class="left btn-group">
        <!--增加按钮-->
        <div class="right btn-group" style="padding-top: 10px;padding-bottom: 10px">
            <button type="button"  data-toggle="modal" v-on:click="conversion_stu()" data-target="#student"  style="width:50px ;height:25px ;font-size: 10px ;">增加</button>
        </div>
        <!--模糊查询框-->
        <div class="right btn-group" style="padding-left: 100px;padding-top: 10px;padding-bottom: 10px">

            <input type="text"  placeholder="搜索" class="form-control" style="height: 25px" name="pname" id="queryLike" >
        </div>
        <!--模糊查询按钮-->
        <div style="float: left ;padding-left: 10px; padding-top: 15px">
            <button style="background-color:#edf6fa;"  v-on:click="inqire_person()" >
                <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            </button>

        </div>

    </div>

    <!--增加模块-->
    <div id="student" class="modal fade" tabindex="-1" oler="dialog"  labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" >&times;</span>
                    </button>
                    <h4>{{modal_title}}</h4>
                </div>
                <form id="form2" class="form-horizontal" >
                    <div class="modal-body">

                        <div class="form-group">
                            <input class="hidden" name="id" v-bind:value="person_By.id"  />
                            <label class="col-sm-3 control-label" >姓名</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="name" v-bind:value="person_By.name"  placeholder="请输入姓名" style="width: 300px">
                            </div>
                        </div>



                        <div class="form-group" style="">
                            <label class="col-sm-3 control-label" >年龄</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="age" v-bind:value="person_By.age"  placeholder="请输入年龄" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >性别</label>
                            <div class="col-sm-9">
                                <input id="man" type="radio" checked="checked" name="sex" value="男"/>男 &nbsp;&nbsp;&nbsp;<input id="woman" type="radio"  name="sex" value="女"/>女
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >手机号码</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="mobile" v-bind:value="person_By.mobile"  placeholder="请输入手机号码" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >疾病名称</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="jbname" v-bind:value="person_By.jbname"  placeholder="请输入疾病名称" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group" >
                            <label class="col-sm-3 control-label" >床位号</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="bednum" v-bind:value="person_By.bednum"  placeholder="请输入床位号" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group">
                        <label class="col-sm-3 control-label" >责任医生</label>
                        <div class="col-sm-9">
                            <input type="text" class="form-control"  name="principal" v-bind:value="person_By.principal"  placeholder="请输入责任医生" style="width: 300px">
                        </div>
                    </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >科室名称</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="door" v-bind:value="person_By.door"  placeholder="请输入科室名称" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >出院日期</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control"  name="date" v-bind:value="person_By.date"  placeholder="请输入出院日期" style="width: 300px">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >就诊类型</label>
                            <div class="col-sm-9">
                                <select name="type" id="type">
                                    <option value ="儿科" >儿科</option>
                                    <option value ="皮肤科"> 皮肤科</option>
                                    <option value="急诊科"> 急诊科</option>
                                    <option value="骨科">骨科</option>
                                    <option value="妇产科">妇产科</option>
                                    <option value="脑外科">脑外科</option>
                                    <option value="口腔科">口腔科</option>
                                    <option value="康复科">康复科</option>
                                    <option value="眼科">眼科</option>
                                    <option value="其他">其他</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-3 control-label" >配置状态</label>
                            <div class="col-sm-9">
                                <select name="configured" id="configured">
                                    <option value ="未配置">未配置</option>
                                    <option value ="已配置">已配置</option>
                                </select>
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-3 control-label" >计划状态</label>
                            <div class="col-sm-9">
                            <select name="stateplan" id="stateplan">
                                <option value ="正在进行中">正在进行中</option>
                                <option value ="已完成">已完成</option>
                            </select>
                        </div>
                        </div>


                    </div>
                </form>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"  data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-primary"  v-on:click="save_student()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!--表格模块-->
    <table class="table table-bordered table-hover table-responsive " >
        <tr><td>编号</td>
            <td>姓名</td>
            <td>性别</td>
            <td>年龄</td>
            <td>手机号码</td>
            <td>疾病名称</td>
            <td>床位号</td>
            <td>责任医生</td>
            <td>科室名称</td>
            <td>出院日期</td>
            <td>就诊类型</td>
            <td>配置状态</td>
            <td>计划状态</td>
            <td>操作</td>
        </tr>
        <tr v-for="p in personOutManage"  >
            <td >{{p.id}}</td>
            <td >{{p.name}}</td>
            <td >{{p.sex}}</td>
            <td >{{p.age}}</td>
            <td >{{p.mobile}}</td>
            <td >{{p.jbname}}</td>
            <td >{{p.bednum}}</td>
            <td >{{p.principal}}</td>
            <td >{{p.door}}</td>
            <td >{{p.date}}</td>
            <td >{{p.type}}</td>
            <td >{{p.configured}}</td>
            <td >{{p.stateplan}}</td>
            <td><button style="width:50px ;height:25px ;font-size: 10px"  v-on:click="queryById_stu(p.id)" type="button"  data-toggle="modal" data-target="#student" >修改</button> &nbsp;&nbsp;  <button style="width:50px ;height:25px ;font-size: 10px"  v-on:click="del_(p.id)" data-toggle="modal"  data-target="#myConfirm" type="button">删除</button></td>
        </tr>
        <tr id="page">
            <td colspan="14">
                <!--分页-->
                <div class="u-pages" style="margin-bottom:30px; margin-top:10px; ">
                    <ul>


                        <li  class="crt"><a v-on:click="beginPage()"> &lt;&lt; </a></li><!--首页-->
                        <li  class="crt"><a v-on:click="SPage()"> &lt; </a></li><!--上一页-->

                        <template v-for="n in totalPage">
                            <li  v-on:click="choose(n)" ><a>{{n}}</a></li>
                        </template>


                        <li  class="crt"><a v-on:click="XPage()"> &gt;</a></li><!--下一页-->
                        <li  class="crt"><a v-on:click="pageLast()"> &gt;&gt; </a></li><!--尾页-->

                    </ul>
                </div>

            </td>
        </tr>
    </table>

    <!--确认删除模块-->
    <div class='modal fade' id='myConfirm' >

        <div class='modal-backdrop in' style='opacity:0; '></div>
        <div class='modal-dialog' style='z-index:2901; margin-top:60px; width:400px; '>
            <div class='modal-content'>
                <div class='modal-header'  style='font-size:16px; '>
                    <span class='glyphicon glyphicon-envelope'>&nbsp;</span>信息！<button type='button' class='close' data-dismiss='modal'></button>
                    &times;</div>
                <div class='modal-body text-center' id='myConfirmContent' style='font-size:18px; '>
                    是否确定要删除？
                </div>
                <div class='modal-footer ' style=''>
                    <button class='btn btn-danger ' id='confirmOk' v-on:click="del_person()" >确定</button>

                    <button class='btn btn-info ' data-dismiss='modal'>取消</button>
                </div></div></div>
    </div>


</div>


<script src="../../plugs/jquery/jquery.min.js"></script>
<!--<script src="../../plugs/bootstrap/js/bootstrap.min.js"></script>-->
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="../../plugs/js/vue.min.js"></script>

<script>
    var app_exam=new Vue({
        el:'#exam',
        data:{
            personOutManage:{},
            del_person_id:'',
            modal_title:'增加',
            url_action:'',
            person_By:'',
            begin:0,
            page:1,
            count:0,
            totalPage:0,
        },
        methods:{
            //查询所有
            inqire_person:function () {
                var _this=this;
                //是否模糊查询
                var queryLike_value =  $('#queryLike').val();
                if(queryLike_value==''){
                    _this.url_action='/pageQueryPersonOutManage.action?begin='+_this.begin
                }
                else {
                    _this.url_action='/queryLikePersonOutManage.action?name='+queryLike_value;
                    $('#page').hide();
                }
                $.ajax({
                    url:_this.url_action,
                    type:'post',
                    dataType:'json',
                    success:function (data) {
                        _this.personOutManage=data;
                    }
                })


            },

            //增加的方法(点击增加按钮时)
            conversion_stu:function () {
                this.modal_title='增加';
                var _this=this;
                $.ajax({
                    url:'/getPersonOutManageMaxId.action',
                    type:'get',
                    success:function (date) {
                        _this.person_By=date ;
                    }
                });

            },
            //根据id查询(点击修改时)
            queryById_stu:function(id){
                var _this=this;
                this.modal_title='修改';
                $.ajax({
                    type:"get",
                    dataType:'json',
                    data:'id='+id,
                    url:"/queryPersonOutManageById.action",
                    success:function(data){
                        _this.person_By=data;
                        console.log("data:"+data.sex);

                        var manVal=$('#man').val();
                        if(manVal==data.sex){
                            $('#man').click();
                        }else{
                            $('#woman').click();
                        }

                    //    type选中
                        var typeData=data.type;
                        if(typeData == '儿科'){
                            $("#type option[value='儿科']").attr('selected',true);
                        }else if(typeData == '皮肤科'){
                            $("#type option[value='皮肤科']").attr('selected',true);
                        }else if(typeData == '急诊科'){
                            $("#type option[value='急诊科']").attr('selected',true);
                        }else if(typeData == '骨科'){
                            $("#type option[value='骨科']").attr('selected',true);
                        }else if(typeData == '妇产科'){
                            $("#type option[value='妇产科']").attr('selected',true);
                        }else if(typeData == '脑外科'){
                            $("#type option[value='脑外科']").attr('selected',true);
                        }else if(typeData == '口腔科'){
                            $("#type option[value='口腔科']").attr('selected',true);
                        }
                        else if(typeData == '康复科'){
                            $("#type option[value='康复科']").attr('selected',true);
                        }
                        else if(typeData == '眼科'){
                            $("#type option[value='眼科']").attr('selected',true);
                        }else{
                            $("#type option[value='其他']").attr('selected',true);
                        }

                    //配置状态选中
                        var configVal=data.configured;
                        if(configVal == '未配置'){
                            $("#configured option[value='未配置']").attr('selected',true);
                        }else {
                            $("#configured option[value='已配置']").attr('selected',true);
                        }

                    //    计划状态选中
                        var stateplanVal=data.stateplan;
                        if(stateplanVal == '已完成'){
                            $("#stateplan option[value='已完成']").attr('selected',true);
                        }else {
                            $("#stateplan option[value='正在进行中']").attr('selected',true);
                        }


                    }
                });


            },
            //增加与修改的方法
            save_student:function () {
                var _this=this;
                if(_this.modal_title=="增加"){
                    _this.url_action="/addPersonOutManage.action";
                }
                else if(_this.modal_title=="修改"){
                    _this.url_action="/updatePersonOutManage.action";
                }
                var text=$("#form2").serialize();
                $.ajax({
                    url:_this.url_action,
                    type:'get',
                    data:text,
                    success:function () {
                        $("#student").modal('hide');
                        _this.person_By="";
                        _this.inqire_person();
                    }
                });
            },

            //点击删除的方法
            del_:function(id) {
                this.del_person_id=id;

            },
            //确认删除后的方法
            del_person:function(id){
                var _this=this;
                $.ajax({
                    type:"get",
                    url:"/delPersonOutManage.action",
                    data:'id='+_this.del_person_id,
                    success:function(){
                        $("#myConfirm").modal('hide');
                        _this.inqire_person();
                    }
                });
            },

            //    查询最大数量
            getMaxCount:function(){
                var _this=this;
                $.ajax({
                    type:"get",
                    url:"/getPersonOutManageCount.action",
                    success:function(data){
                        _this.count=data;
                        _this.getMaxPage();
                    }
                });
            },


            //    分页首页
            beginPage:function(){
                var _this=this;
                _this.begin=0;
                _this.page=1;
                _this.inqire_person();
            },

            //    分页尾页
            pageLast:function(){
                var _this=this;
                var totalPage=Math.floor(_this.count/5);
                if(_this.count%5!=0){
                    totalPage+=1;
                }
                _this.page=totalPage;

                _this.begin=(_this.page-1)*5;
                _this.inqire_person();

            },

            //    上页
            SPage:function(){
                var _this=this;
                if(_this.page<=1){
                    _this.page=1;
                    alert("已经是第一页");
                }else {
                    this.page-=1;
                    _this.begin=(_this.page-1)*5;
                }
                _this.inqire_person();
            },
            //    下页
            XPage:function(){
                var _this=this;
                var totalPage=Math.floor(_this.count/5)  ;
                if(_this.count%5!=0){
                    totalPage+=1;
                }
                if(_this.page>=totalPage){
                    _this.page=totalPage;
                    alert("已经是最后一页");
                }else {
                    _this.page+=1;
                }
                _this.begin=(_this.page-1)*5;
                _this.inqire_person();
            },
            //    总分页数
            getMaxPage:function(){
                var _this=this;
                var totalPage=Math.floor(_this.count/5)  ;
                if(_this.count%5!=0){
                    totalPage+=1;
                    _this.totalPage=totalPage;

                }

            },
            //页数点击
            choose: function (l) {
                console.log(l);
                var page=l;
                var _this=this;
                _this.page=page;
                _this.begin=(_this.page-1)*5;
                _this.inqire_person();
            }




        }
    });

    app_exam.getMaxCount();
    app_exam.inqire_person();





</script>

</body>
</html>